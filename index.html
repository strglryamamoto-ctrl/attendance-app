<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å‡ºé€€å‹¤ãƒˆãƒ©ãƒƒã‚«ãƒ¼ï¼ˆLINEãƒ­ã‚°ã‚¤ãƒ³ + ç®¡ç†è€…ä¸€è¦§ç‰ˆï¼‰</title>
  <style>
    :root {
      --bg: #f7f7fb;
      --card: #ffffff;
      --ink: #1f2937;
      --ink-dim: #4b5563;
      --brand: #06c755; /* LINEã‚°ãƒªãƒ¼ãƒ³ã«å¯„ã›ã‚‹ */
      --ok: #10b981;
      --warn: #f59e0b;
      --bad: #ef4444;
      --muted: #e5e7eb;
      --shadow: 0 10px 30px rgba(17,24,39,0.08);
      --radius: 16px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background: linear-gradient(135deg, #f2f6ff, #fefefe);
      color: var(--ink);
    }
    .container { max-width: 1100px; margin: 24px auto 64px; padding: 0 16px; }
    header { display: flex; gap: 16px; align-items: center; justify-content: space-between; margin-bottom: 16px; }
    .title { font-size: clamp(20px, 2.2vw, 28px); font-weight: 800; letter-spacing: .2px; display: flex; align-items: center; gap: 10px; }
    .clock { font-variant-numeric: tabular-nums; color: var(--ink-dim); }
    .grid { display: grid; gap: 18px; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
    .card { background: var(--card); border-radius: var(--radius); box-shadow: var(--shadow); padding: 18px; border: 1px solid var(--muted); }
    .row { display: flex; gap: 10px; align-items: center; }
    .row.wrap { flex-wrap: wrap; }
    .grow { flex: 1; }
    label { font-size: 12px; color: var(--ink-dim); display: block; margin-bottom: 6px; }
    input, select, button, textarea { font: inherit; border-radius: 12px; border: 1px solid var(--muted); padding: 10px 12px; background: #fff; color: var(--ink); }
    input:focus, select:focus, textarea:focus { outline: 2px solid #c7ddff; border-color: #a3c7ff; }
    button { border: none; cursor: pointer; font-weight: 700; letter-spacing: .2px; transition: transform .03s ease-in-out, box-shadow .2s; }
    button:active { transform: translateY(1px); }
    .btn { background: var(--brand); color: #fff; }
    .btn:hover { box-shadow: var(--shadow); }
    .btn-ghost { background: #fff; color: var(--ink); border: 1px solid var(--muted); }
    .btn-ok { background: var(--ok); color:#fff; }
    .btn-warn { background: var(--warn); color:#fff; }
    .btn-bad { background: var(--bad); color:#fff; }
    .tag { padding: 4px 8px; font-size: 12px; border-radius: 999px; border:1px solid var(--muted); background:#fff; }
    .kpi { font-weight: 800; font-size: 20px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border-bottom: 1px solid var(--muted); padding: 10px 8px; text-align: left; font-size: 14px; }
    th { font-size: 12px; color: var(--ink-dim); text-transform: uppercase; letter-spacing: .6px; }
    .hint { font-size: 12px; color: var(--ink-dim); }
    .pillbar { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
    .pillbar button { padding: 12px 8px; }
    footer { margin-top: 16px; text-align: center; color: var(--ink-dim); font-size: 12px; }
    .danger { color: var(--bad); }
    .warn { color: var(--warn); }
    .mono { font-variant-numeric: tabular-nums; }
    .sr-only { position: absolute; left: -10000px; }
    .flex-between { display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .avatar { width:32px; height:32px; border-radius:999px; object-fit:cover; border:1px solid var(--muted); }
    .role-badge { font-size:12px; border:1px solid var(--muted); border-radius:999px; padding:2px 8px; background:#fff; }
  </style>
  <!-- LINE LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <!-- Supabaseï¼ˆå¿…è¦ãªã‚‰æœ‰åŠ¹åŒ–ï¼‰ -->
  <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <div class="container">
    <header>
      <div class="title">å‡ºé€€å‹¤ãƒˆãƒ©ãƒƒã‚«ãƒ¼ <span class="tag">LINEãƒ­ã‚°ã‚¤ãƒ³å¯¾å¿œ</span></div>
      <div class="clock" id="clock">--:--:--</div>
    </header>

    <!-- ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ãƒãƒ¼ -->
    <section class="card" style="margin-bottom:18px;">
      <div class="flex-between">
        <div id="loginState" class="row" style="gap:10px;">
          <img id="avatar" class="avatar" alt="avatar" src="" style="display:none;" />
          <div>
            <div id="welcome">æœªãƒ­ã‚°ã‚¤ãƒ³</div>
            <div class="hint" id="roleInfo">role: guest</div>
          </div>
        </div>
        <div class="row" style="gap:8px;">
          <button id="btnLogin" class="btn">LINEã§ãƒ­ã‚°ã‚¤ãƒ³</button>
          <button id="btnLogout" class="btn-ghost" style="display:none;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        </div>
      </div>
    </section>

    <div class="grid">
      <!-- æ‰“åˆ»ã‚«ãƒ¼ãƒ‰ -->
      <section class="card" aria-labelledby="ops-title">
        <div class="flex-between">
          <h2 id="ops-title" style="margin:0 0 10px 0; font-size:18px;">æ‰“åˆ»</h2>
          <span class="role-badge" id="roleBadge">guest</span>
        </div>
        <div class="row wrap" style="gap:12px; margin-bottom:12px;">
          <div class="grow">
            <label for="user">ãƒ¦ãƒ¼ã‚¶ãƒ¼</label>
            <input id="user" placeholder="LINEãƒ­ã‚°ã‚¤ãƒ³ã§è‡ªå‹•å…¥åŠ›" disabled />
          </div>
          <div>
            <label for="team">ãƒãƒ¼ãƒ /æ‹ ç‚¹</label>
            <input id="team" placeholder="ä»»æ„" />
          </div>
          <div>
            <label for="shiftStart">å®šæ™‚ï¼ˆé–‹å§‹ï¼‰</label>
            <input type="time" id="shiftStart" value="09:00" />
          </div>
          <div>
            <label for="shiftEnd">å®šæ™‚ï¼ˆçµ‚äº†ï¼‰</label>
            <input type="time" id="shiftEnd" value="18:00" />
          </div>
        </div>

        <div class="pillbar" style="margin-bottom:10px;">
          <button class="btn-ok" data-action="wake">èµ·åºŠ</button>
          <button class="btn-warn" data-action="depart">å‡ºç™º</button>
          <button class="btn" data-action="clockin">å‡ºå‹¤</button>
          <button class="btn-bad" data-action="clockout">é€€å‹¤</button>
        </div>
        <div class="row wrap" style="gap:8px; margin-bottom:8px;">
          <input id="note" class="grow" placeholder="ãƒ¡ãƒ¢ï¼ˆé…å»¶ç†ç”±ãªã©ï¼‰" />
          <button class="btn-ghost" id="quickLate">5åˆ†é…ã‚Œ</button>
          <button class="btn-ghost" id="quickWorkFromHome">åœ¨å®…</button>
        </div>
        <div class="hint">LINEãƒ­ã‚°ã‚¤ãƒ³ã®è¡¨ç¤ºåã§è¨˜éŒ²ã—ã¾ã™ã€‚èª¤æ‰“åˆ»ã¯ä¸€è¦§ã®ğŸ—‘ï¸ã§å‰Šé™¤å¯ã€‚</div>
      </section>

      <!-- ä»Šæ—¥ã®ã‚µãƒãƒªãƒ¼ -->
      <section class="card" aria-labelledby="summary-title">
        <h2 id="summary-title" style="margin:0 0 10px 0; font-size:18px;">ä»Šæ—¥ã®ã‚µãƒãƒªãƒ¼</h2>
        <div class="row wrap" style="gap:12px;">
          <div class="card" style="flex:1; border:1px dashed var(--muted);">
            <div class="hint">æ‰“åˆ»äººæ•°</div>
            <div class="kpi mono" id="kpiPeople">0</div>
          </div>
          <div class="card" style="flex:1; border:1px dashed var(--muted);">
            <div class="hint">é…åˆ»ï¼ˆå‡ºå‹¤ãŒå®šæ™‚ã‚’è¶…éï¼‰</div>
            <div class="kpi mono danger" id="kpiLate">0</div>
          </div>
          <div class="card" style="flex:1; border:1px dashed var(--muted);">
            <div class="hint">æœªå‡ºå‹¤ï¼ˆèµ·åºŠ/å‡ºç™ºã®ã¿ï¼‰</div>
            <div class="kpi mono warn" id="kpiNoClockIn">0</div>
          </div>
        </div>
      </section>
    </div>

    <!-- ãƒ­ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆç®¡ç†è€…å‘ã‘ã¯å…¨ä½“é›†è¨ˆï¼‰ -->
    <section class="card" style="margin-top:18px;" aria-labelledby="log-title">
      <div class="flex-between">
        <h2 id="log-title" style="margin:0 0 10px 0; font-size:18px;">ãƒ­ã‚°ï¼ˆæœ¬æ—¥ï¼‰</h2>
        <div class="row" style="gap:8px;">
          <span class="hint" id="dataSource">Data: LocalStorage</span>
          <button id="exportCsv" class="btn">CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
          <button id="exportJson" class="btn-ghost">JSONä¿å­˜</button>
          <label for="importFile" class="btn-ghost" style="cursor:pointer;">JSONèª­ã¿è¾¼ã¿</label>
          <input id="importFile" type="file" accept="application/json" class="sr-only" />
          <button id="clearToday" class="btn-bad">ä»Šæ—¥ã‚’å…¨æ¶ˆã—</button>
        </div>
      </div>
      <div class="row wrap" style="gap:8px; margin-bottom:8px;">
        <input id="search" class="grow" placeholder="æ¤œç´¢ï¼šæ°å/ãƒ¡ãƒ¢/ãƒãƒ¼ãƒ " />
        <select id="scope">
          <option value="mine">è‡ªåˆ†ã®ã¿</option>
          <option value="all">å…¨ä½“ï¼ˆç®¡ç†è€…ï¼‰</option>
        </select>
      </div>
      <div class="hint" id="alertZone">å®šæ™‚è¶…éã®äººãŒå‡ºã‚‹ã¨ã“ã“ã«âš ï¸ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</div>
      <div style="overflow:auto;">
        <table id="table">
          <thead>
            <tr>
              <th>æ°å</th>
              <th>ãƒãƒ¼ãƒ </th>
              <th>èµ·åºŠ</th>
              <th>å‡ºç™º</th>
              <th>å‡ºå‹¤</th>
              <th>é€€å‹¤</th>
              <th>ãƒ¡ãƒ¢</th>
              <th>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </section>

    <footer>
      <span>ä¿å­˜å…ˆã¯ LocalStorage / Supabase ã‚’é¸æŠå¯èƒ½ã€‚LINEãƒ­ã‚°ã‚¤ãƒ³ï¼ˆLIFFï¼‰ã€‚</span>
    </footer>
  </div>

  <script>
    // ===================== è¨­å®šï¼ˆã“ã“ã‚’æ›¸ãæ›ãˆï¼‰ =====================
    const LIFF_ID = '2007926375-NpkwlE1J'; // LINE Developers ã§å–å¾—
    const ADMINS = [U02a56336d5ae934d95a1bf5931b33b64];

    // Supabaseï¼ˆä»»æ„ï¼šå…¨ä½“å…±æœ‰ã‚„å¤šæ‹ ç‚¹é‹ç”¨ã‚’ã™ã‚‹ãªã‚‰è¨­å®šï¼‰
    const SUPABASE_URL = '';
    const SUPABASE_ANON_KEY = '';
    const USE_SUPABASE = !!(SUPABASE_URL && SUPABASE_ANON_KEY);

    // ===================== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ =====================
    const $ = (s) => document.querySelector(s);
    const pad = (n) => String(n).padStart(2, '0');
    const todayStr = () => { const d = new Date(); return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`; };
    const nowIso = () => new Date().toISOString();
    const fmtTime = (iso) => iso ? new Date(iso).toLocaleTimeString('ja-JP',{hour:'2-digit',minute:'2-digit',second:'2-digit'}) : '';

    let state = { profile:null, role:'guest', userName:'', userId:'', supabase:null };

    function tickClock(){ const d=new Date(); $('#clock').textContent=`${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`; }
    setInterval(tickClock, 1000); tickClock();

    // ===================== ãƒ‡ãƒ¼ã‚¿å±¤ =====================
    const LS_KEY = 'attendance.v2';

    // LocalStorage å®Ÿè£…
    function ls_getAll(){ try{ return JSON.parse(localStorage.getItem(LS_KEY))||{} }catch{ return {} } }
    function ls_setAll(obj){ localStorage.setItem(LS_KEY, JSON.stringify(obj)); }
    function ls_getDay(date=todayStr()) { const all=ls_getAll(); return all[date]||[]; }
    function ls_setDay(list, date=todayStr()) { const all=ls_getAll(); all[date]=list; ls_setAll(all); }

    // Supabase å®Ÿè£…
    async function sb_init(){ if(!USE_SUPABASE) return null; state.supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY); return state.supabase; }
    async function sb_getDay(date=todayStr()){
      const { data, error } = await state.supabase.from('records').select('*').eq('date', date).order('team', { ascending:true }).order('name', { ascending:true });
      if(error){ console.error(error); alert('DBèª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ'); return []; }
      return data || [];
    }
    async function sb_upsert(rec){
      const payload = { ...rec, date: todayStr() };
      const { error } = await state.supabase.from('records').upsert(payload, { onConflict:'date,name' });
      if(error){ console.error(error); alert('DBæ›¸ãè¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ'); }
    }
    async function sb_deleteByName(name){
      const { error } = await state.supabase.from('records').delete().eq('date', todayStr()).eq('name', name);
      if(error){ console.error(error); alert('DBå‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ'); }
    }

    // ãƒ‡ãƒ¼ã‚¿æŠ½è±¡ãƒ¬ã‚¤ãƒ¤ãƒ¼
    const store = {
      async getDay(){ return USE_SUPABASE ? await sb_getDay() : ls_getDay(); },
      async setOrUpsert(rec){
        if(USE_SUPABASE){ await sb_upsert(rec); }
        else {
          const list = ls_getDay();
          let found = list.find(r=>r.name===rec.name);
          if(found) Object.assign(found, rec); else list.push(rec);
          ls_setDay(list);
        }
      },
      async delByName(name){ return USE_SUPABASE ? await sb_deleteByName(name) : (ls_setDay(ls_getDay().filter(r=>r.name!==name))); }
    };

    // ===================== ç”»é¢ãƒ­ã‚¸ãƒƒã‚¯ =====================
    function applyRole(){
      const badge = $('#roleBadge');
      const scope = $('#scope');
      const roleInfo = $('#roleInfo');
      badge.textContent = state.role;
      roleInfo.textContent = `role: ${state.role}`;
      if(state.role !== 'admin') scope.value = 'mine';
      scope.disabled = (state.role !== 'admin');
    }

    function setProfileUI(){
      const avatar = $('#avatar');
      const welcome = $('#welcome');
      if(state.profile){
        avatar.src = state.profile.pictureUrl || '';
        avatar.style.display = state.profile.pictureUrl ? 'block' : 'none';
        welcome.textContent = `${state.profile.displayName} ã•ã‚“ã€ã“ã‚“ã«ã¡ã¯`;
        $('#user').value = state.profile.displayName;
      } else {
        avatar.style.display = 'none';
        welcome.textContent = 'æœªãƒ­ã‚°ã‚¤ãƒ³';
        $('#user').value = '';
      }
    }

    async function ensureLogin(){
      if(!LIFF_ID){ alert('LIFF_ID ã‚’è¨­å®šã—ã¦ãã ã•ã„'); return; }
      await liff.init({ liffId: LIFF_ID });
      if(!liff.isLoggedIn()) return;
      const profile = await liff.getProfile();
      state.profile = profile;
      state.userName = profile.displayName;
      state.userId = profile.userId;
      state.role = ADMINS.includes(profile.userId) ? 'admin' : 'member';
      $('#btnLogin').style.display = 'none';
      $('#btnLogout').style.display = 'inline-flex';
      setProfileUI();
      applyRole();
      render();
    }

    // ===== æ‰“åˆ»ã‚¢ãƒƒãƒ—ã‚µãƒ¼ãƒˆ =====
    async function upsert(action){
      if(!state.profile){ alert('LINEã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„'); return; }
      const name = state.userName;
      const team = $('#team').value.trim();
      const shiftStart = $('#shiftStart').value || '09:00';
      const shiftEnd = $('#shiftEnd').value || '18:00';
      const note = $('#note').value.trim();

      const list = await store.getDay();
      let rec = list.find(r => r.name === name) || { name, team, shiftStart, shiftEnd, note:'', wake:null, depart:null, in:null, out:null };
      rec.team = team; rec.shiftStart = shiftStart; rec.shiftEnd = shiftEnd;
      if(note) rec.note = (rec.note ? rec.note + ' / ' : '') + note;
      const t = nowIso();
      if(action==='wake') rec.wake = rec.wake || t;
      if(action==='depart') rec.depart = rec.depart || t;
      if(action==='clockin') rec.in = rec.in || t;
      if(action==='clockout') rec.out = rec.out || t;

      await store.setOrUpsert(rec);
      $('#note').value = '';
      render();
    }

    async function delRecord(name){
      if(state.role!=='admin' && name!==state.userName){ alert('å‰Šé™¤ã¯è‡ªåˆ†ã®è¨˜éŒ²ã®ã¿å¯èƒ½ã§ã™'); return; }
      await store.delByName(name);
      render();
    }

    async function render(){
      const q = $('#search').value.trim().toLowerCase();
      const scope = $('#scope').value; // mine/all
      const list = await store.getDay();
      const tbody = $('#tbody');
      tbody.innerHTML = '';

      const filtered = list.filter(r => {
        const text = JSON.stringify(r).toLowerCase();
        const match = !q || text.includes(q);
        const mine = !state.profile || scope==='all' || r.name===state.userName;
        return match && mine;
      }).sort((a,b)=> (a.team||'').localeCompare(b.team||'') || a.name.localeCompare(b.name));

      let late=0, inOnly=0, count=0;
      const [sh, sm] = ($('#shiftStart').value || '09:00').split(':').map(Number);
      const shiftStartToday = new Date(); shiftStartToday.setHours(sh, sm, 0, 0);

      filtered.forEach(r => {
        count++;
        const tr = document.createElement('tr');
        const isLate = r.in && new Date(r.in) > shiftStartToday;
        const noClockIn = !r.in && (r.wake || r.depart);
        if(isLate) late++;
        if(noClockIn) inOnly++;
        tr.innerHTML = `
          <td>${r.name}</td>
          <td>${r.team||''}</td>
          <td class="mono">${fmtTime(r.wake)}</td>
          <td class="mono">${fmtTime(r.depart)}</td>
          <td class="mono ${isLate?'danger':''}">${fmtTime(r.in)}</td>
          <td class="mono">${fmtTime(r.out)}</td>
          <td>${r.note||''}</td>
          <td><button class="btn-ghost" data-del="${r.name}">ğŸ—‘ï¸</button></td>`;
        tbody.appendChild(tr);
      });

      $('#kpiPeople').textContent = String(count);
      $('#kpiLate').textContent = String(late);
      $('#kpiNoClockIn').textContent = String(inOnly);

      const alert = [];
      if(late>0) alert.push(`âš ï¸ é…åˆ» ${late} å`);
      if(inOnly>0) alert.push(`â³ æœªå‡ºå‹¤ ${inOnly} å`);
      $('#alertZone').textContent = alert.join(' / ') || 'å®šæ™‚è¶…éã®äººãŒå‡ºã‚‹ã¨ã“ã“ã«âš ï¸ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚';

      $('#dataSource').textContent = `Data: ${USE_SUPABASE ? 'Supabase' : 'LocalStorage'}`;
    }

    // ===================== ã‚¤ãƒ™ãƒ³ãƒˆ =====================
    document.addEventListener('click', (e)=>{
      if(e.target.matches('[data-action]')) upsert(e.target.getAttribute('data-action'));
      if(e.target.matches('[data-del]')){ const name=e.target.getAttribute('data-del'); if(confirm(`${name} ã‚’æœ¬æ—¥ã®ãƒ­ã‚°ã‹ã‚‰å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) delRecord(name); }
    });
    $('#search').addEventListener('input', render);
    $('#exportCsv').addEventListener('click', async ()=>{
      const list = await store.getDay();
      const headers = ['date','name','team','wake','depart','in','out','shiftStart','shiftEnd','note'];
      const rows = list.map(r => [todayStr(), r.name, r.team||'', r.wake||'', r.depart||'', r.in||'', r.out||'', r.shiftStart||'', r.shiftEnd||'', (r.note||'').replace(/
/g,' ')]);
      const csv = [headers.join(','), ...rows.map(a=>a.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(','))].join('
');
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `attendance_${todayStr()}.csv`; a.click();
    });
    $('#exportJson').addEventListener('click', ()=>{ const data = USE_SUPABASE? { note:'Supabaseåˆ©ç”¨æ™‚ã¯DBå´ãŒæ­£'}, ls_getAll(); });
    $('#importFile').addEventListener('change', (e)=> e.target.files[0] && (function(file){ const reader=new FileReader(); reader.onload=()=>{ try{ const obj=JSON.parse(reader.result); if(typeof obj!== 'object') throw new Error('å½¢å¼ä¸æ­£'); localStorage.setItem(LS_KEY, JSON.stringify(obj)); render(); alert('èª­ã¿è¾¼ã¿ã¾ã—ãŸ'); }catch{ alert('JSONã®å½¢å¼ãŒä¸æ­£ã§ã™'); } }; reader.readAsText(file); })(e.target.files[0]));
    $('#clearToday').addEventListener('click', async ()=>{ if(confirm('æœ¬æ—¥ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å…¨ã¦å‰Šé™¤ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')){ if(USE_SUPABASE){ const list=await store.getDay(); for(const r of list){ await store.delByName(r.name); } } else { ls_setDay([]); } render(); }});

    $('#quickLate').addEventListener('click', ()=> $('#note').value = ($('#note').value? $('#note').value+' / ' : '') + '5åˆ†é…ã‚Œ');
    $('#quickWorkFromHome').addEventListener('click', ()=> $('#note').value = ($('#note').value? $('#note').value+' / ' : '') + 'åœ¨å®…');

    $('#scope').addEventListener('change', render);

    // ===================== èµ·å‹•æ™‚å‡¦ç† =====================
    (async function init(){
      if(USE_SUPABASE) await sb_init();
      applyRole(); setProfileUI(); render();
      try{ await ensureLogin(); }catch(e){ console.warn('LIFFåˆæœŸåŒ–æœªè¨­å®š or éå¯¾å¿œç’°å¢ƒ', e); }

      // ãƒ­ã‚°ã‚¤ãƒ³/ã‚¢ã‚¦ãƒˆ
      $('#btnLogin').onclick = ()=> liff.login();
      $('#btnLogout').onclick = ()=> { liff.logout(); location.reload(); };
    })();
  </script>
</body>
</html>

</html>

